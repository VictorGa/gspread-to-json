{"version":3,"sources":["../../develop/src/SpreadsheetController.js"],"names":[],"mappings":"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","file":"SpreadsheetController.js","sourcesContent":["var UtilParser = require('./parser/UtilParser');\nvar config = require('../../config');\nvar GoogleSpreadsheet = require(\"google-spreadsheet\");\nvar Promise = require('native-or-bluebird');\n\nfunction SpreadsheetController(id, onReady) {\n    this._incompatibleTags = ['_links', 'save', 'del', 'content', '_xml'];\n\n    this.sheet = new GoogleSpreadsheet(id);\n    this.sheet.useServiceAccountAuth(config.googleauth, this.init.bind(this, onReady));\n}\n\nSpreadsheetController.prototype.init = function (onReady) {\n    var self = this;\n    this.sheet.getInfo(function (err, sheet_info) {\n        self.data = sheet_info;\n        onReady();\n    });\n}\n\nSpreadsheetController.prototype.getAll = function (clean = true) {\n\n    return new Promise((resolve, reject)=>\n    {\n        let iterables = this.data.worksheets.map((element, index) => {\n            return this.getRow(element, clean);\n        });\n\n        Promise.all(iterables).then(\n            results => {\n            //results is an array of objects, each object being a worksheet\n            //now we merge all in one object\n            resolve(Object.assign(...results));\n        },\n            error => {\n                reject(error);\n        });\n    });\n}\n\nSpreadsheetController.prototype.getRow = function (element, clean) {\n    return new Promise((resolve, reject) => {\n        element.getRows((err, rows)=> {\n            if (err) {\n                reject(err);\n            }\n            else {\n                resolve({[element.title]: this.filter(rows, clean)});\n            }\n        });\n    })\n}\n\nSpreadsheetController.prototype.filter = function (rows, clean) {\n    var filtered = [];\n    var filteredRow = {};\n\n    for (var i = 0; i < rows.length; i++) {\n        filteredRow = {};\n\n        for (var key in rows[i]) {\n            if (rows[i].hasOwnProperty(key) && this._incompatibleTags.indexOf(key) === -1)\n            {\n                let filteredKey = '';\n                if(key.indexOf('locale') === -1)\n                {\n                    filteredKey = UtilParser.camelize(UtilParser.cleanSpaces(key));\n                }\n                else\n                {\n                    filteredKey = UtilParser.cleanSpaces(key);\n                }\n                filteredRow[filteredKey] = clean ? UtilParser.cleanSpaces(rows[i][key]) : rows[i][key];\n            }\n        }\n\n        filtered.push(filteredRow);\n    }\n\n    return filtered;\n}\n\nSpreadsheetController.prototype.getCellsByWorksheetId = function (worksheetId, onReady) {\n    for (var i = 0; i < this.data.worksheets.length; i++) {\n        if (this.data.worksheets[i].title === worksheetId) {\n            this.data.worksheets[i].getCells(this.data.worksheets[i].id, function (off, data) {\n                onReady(data);\n            });\n            return;\n        }\n    }\n}\n\nmodule.exports = SpreadsheetController;\n\n"]}