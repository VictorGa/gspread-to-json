{"version":3,"sources":["../../develop/src/SpreadsheetController.js"],"names":[],"mappings":"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","file":"SpreadsheetController.js","sourcesContent":["import Parsers from './Parsers';\nvar config = require('../../config');\nvar GoogleSpreadsheet = require(\"google-spreadsheet\");\nvar Promise = require('native-or-bluebird');\n\nclass SpreadsheetController\n{\n    constructor(id, onReady)\n    {\n        this._incompatibleTags = ['_links', 'save', 'del', 'content', '_xml'];\n\n        this.sheet = new GoogleSpreadsheet(id);\n        this.sheet.useServiceAccountAuth(config.googleauth, this.init.bind(this, onReady));\n    }\n\n    init(onReady) {\n        var self = this;\n        this.sheet.getInfo((err, sheet_info) => {\n            self.data = sheet_info;\n            onReady();\n        });\n    }\n\n    getAll(clean = true) {\n\n        return new Promise((resolve, reject)=>\n        {\n            let iterables = this.data.worksheets.map((element, index) => {\n                return this.getRow(element, clean);\n            });\n\n            Promise.all(iterables).then(\n                results => {\n                    //results is an array of objects, each object being a worksheet\n                    //now we merge all in one object\n                    resolve(Object.assign(...results));\n                },\n                error => {\n                    reject(error);\n                });\n        });\n    }\n\n    getRow(element, clean) {\n        return new Promise((resolve, reject) => {\n            element.getRows((err, rows)=> {\n                if (err) {\n                    reject(err);\n                }\n                else {\n                    resolve({[element.title]: this.filter(rows, clean)});\n                }\n            });\n        })\n    }\n\n    filter(rows, clean) {\n        var filtered = [];\n        var filteredRow = {};\n\n        for (var i = 0; i < rows.length; i++) {\n            filteredRow = {};\n\n            for (var key in rows[i]) {\n                if (rows[i].hasOwnProperty(key) && this._incompatibleTags.indexOf(key) === -1)\n                {\n                    let filteredKey = '';\n                    if(key.indexOf('locale') === -1)\n                    {\n                        filteredKey = Parsers.camelize(Parsers.cleanSpaces(key));\n                    }\n                    else\n                    {\n                        filteredKey = Parsers.cleanSpaces(key);\n                    }\n                    filteredRow[filteredKey] = clean ? Parsers.cleanSpaces(rows[i][key]) : rows[i][key];\n                }\n            }\n\n            filtered.push(filteredRow);\n        }\n\n        return filtered;\n    }\n\n    getCellsByWorksheetId(worksheetId, onReady) {\n        for (var i = 0; i < this.data.worksheets.length; i++) {\n            if (this.data.worksheets[i].title === worksheetId) {\n                this.data.worksheets[i].getCells(this.data.worksheets[i].id, function (off, data) {\n                    onReady(data);\n                });\n                return;\n            }\n        }\n    }\n\n}\n\nexport function fecthSpreadsheet(sheet, cleanSpaces = true) {\n\n    console.log(`Fetching data from ${sheet.name}`.bgBlue.white);\n    return new Promise((resolve, reject) => {\n        let spreadsheet = new SpreadsheetController(sheet.id, ()=> {\n            spreadsheet.getAll(cleanSpaces).then(data => resolve(data), error => reject(error));\n        });\n    });\n};\n\nexport default SpreadsheetController;\n\n"]}