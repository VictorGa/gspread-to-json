{"version":3,"sources":["../../develop/src/main.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["'use strict';\n\nimport {default as SpreadsheetController, fecthSpreadsheet, loadSpreadsheets}  from './SpreadsheetController';\nimport {parseRelations,applyRelations} from './RelationParser';\nimport {parseTab, parseRow, convertRowToDict} from './TabUtils';\nimport {write, writeAll} from './FileWriter';\nimport Parsers from './Parsers';\n\nconst Promise = require('native-or-bluebird');\nconst relationKey = '__relation__';\n\nexport function filterTabNames(tabName)\n{\n\treturn tabName !== relationKey;\n}\n\nexport function execute(spreadsheets, callback = ()=>{})\n{\n\n\tGLOBAL.isNode = false;\n\n\tconsole.log(GLOBAL.isNode);\n\n\t//Fetch spreadsheets\n\tlet spreadsheetsLoaded = Promise.all(loadSpreadsheets(spreadsheets));\n\n\tspreadsheetsLoaded.then(results =>\n\t{\n\t\tconsole.log('>>> results' , results);\n\t\tlet fileUrls = [];\n\t\t//Build Id links\n\t\tresults.forEach(data =>\n\t\t{\n\t\t\t//Get relations if exists\n\t\t\tlet relations;\n\t\t\tlet spreadsheet = data.results;\n\t\t\tlet tabKeys = Object.keys(spreadsheet);\n\n\t\t\tconsole.log('>> results', tabKeys)\n\n\t\t\t//Check if there is a relation tab\n\t\t\tif(tabKeys.indexOf(relationKey) !== -1)\n\t\t\t{\n\t\t\t\trelations = parseRelations(spreadsheet[relationKey].rows);\n\n\t\t\t\t//Remove it from keys\n\t\t\t\tlet idx = tabKeys.indexOf(relationKey);\n\t\t\t\ttabKeys.splice(idx, 1);\n\t\t\t}\n\n\t\t\t//Parse tabs regular tabs\n\t\t\tlet parsedTabs = tabKeys.map(parseTab.bind(this, spreadsheet));\n\n\t\t\t//Merge tabs\n\t\t\tparsedTabs = Object.assign(...parsedTabs);\n\n\t\t\t//Once we have all well parsed, let's check relations\n\t\t\tif(typeof relations !== 'undefined')\n\t\t\t{\n\t\t\t\tapplyRelations(relations, parsedTabs);\n\t\t\t}\n\n\t\t\t//Sort by files and locales\n\t\t\tlet files = {};\n\t\t\tObject.keys(parsedTabs)\n\t\t\t\t  .filter(filterTabNames)\n\t\t\t\t  .forEach(tabName =>\n\t\t\t\t  {\n\t\t\t\t\t  let {rows, localizedRows} = parsedTabs[tabName];\n\t\t\t\t\t  let locales = Object.keys(localizedRows);\n\n\t\t\t\t\t  if(locales.length)\n\t\t\t\t\t  {\n\t\t\t\t\t\t  locales.forEach(locale =>\n\t\t\t\t\t\t  {\n\t\t\t\t\t\t\t  //Create locale\n\t\t\t\t\t\t\t  if(typeof files[locale] === 'undefined')\n\t\t\t\t\t\t\t  {\n\t\t\t\t\t\t\t\t  files[locale] = {};\n\t\t\t\t\t\t\t  }\n\n\t\t\t\t\t\t\t  rows = rows.map((row, index) =>\n\t\t\t\t\t\t\t  {\n\t\t\t\t\t\t\t\t  let localized = localizedRows[locale][index];\n\t\t\t\t\t\t\t\t  return Object.assign(row, localized);\n\t\t\t\t\t\t\t  });\n\n\t\t\t\t\t\t\t  parsedTabs[tabName].rows = rows;\n\t\t\t\t\t\t\t  files[locale][tabName] = parsedTabs[tabName].rows;\n\t\t\t\t\t\t  });\n\t\t\t\t\t  }\n\t\t\t\t\t  else\n\t\t\t\t\t  {\n\t\t\t\t\t\t  if(typeof files[data.title] === 'undefined')\n\t\t\t\t\t\t  {\n\t\t\t\t\t\t\t  files[data.title] = {};\n\t\t\t\t\t\t  }\n\n\t\t\t\t\t\t  let tab = tabName;\n\t\t\t\t\t\t  if(parsedTabs[tabName].isDict)\n\t\t\t\t\t\t  {\n\t\t\t\t\t\t\t  let dict = {};\n\t\t\t\t\t\t\t  rows.forEach(convertRowToDict.bind(this, dict));\n\t\t\t\t\t\t\t  tab = Parsers.cleanDict(tabName);\n\t\t\t\t\t\t\t  rows = dict;\n\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t  else if(parsedTabs[tabName].isObjParse)\n\t\t\t\t\t\t  {\n\t\t\t\t\t\t\t  tab = Parsers.cleanObjParse(tabName);\n\t\t\t\t\t\t  }\n\n\t\t\t\t\t\t  files[data.title][tab] = rows;\n\t\t\t\t\t  }\n\t\t\t\t  });\n\n\t\t\t//Save all files\n\t\t\tfileUrls = fileUrls.concat(writeAll(files));\n\t\t});\n\n\t\tcallback(fileUrls);\n\t});\n}\n\n\n"]}