{"version":3,"sources":["../develop/main.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["require(\"babel-core/polyfill\");\r\nvar config = require('../config.json');\r\nvar fs = require('fs');\r\nvar colors = require('colors');\r\nvar Promise = require('native-or-bluebird');\r\n\r\nimport {default as SpreadsheetController, fecthSpreadsheet}  from './src/SpreadsheetController';\r\nimport {parseRelations,applyRelations} from './src/RelationParser';\r\nimport {parseTab, parseRow, convertRowToDict} from './src/TabUtils';\r\nimport Parsers from './src/Parsers';\r\n\r\nlet invalidMediaProps = ['id', 'title'];\r\nconst relationKey = '__relation__';\r\n\r\nexport function filterTabNames(tabName)\r\n{\r\n\treturn tabName !== relationKey;\r\n}\r\n\r\nvar Main = function()\r\n{\r\n\r\n\tlet metadata = [fecthSpreadsheet(config.spreadsheetTranslations)];\r\n\r\n\tPromise.all(metadata).then(results =>\r\n\t{\r\n\t\t//Build Id links\r\n\t\tresults.forEach(data =>\r\n\t\t{\r\n\t\t\t//Get relations if exists\r\n\t\t\tlet relations;\r\n\t\t\tlet spreadsheet = data.results;\r\n\t\t\tlet tabKeys = Object.keys(spreadsheet);\r\n\r\n\t\t\tif(tabKeys.includes(relationKey))\r\n\t\t\t{\r\n\t\t\t\trelations = parseRelations(spreadsheet[relationKey].rows);\r\n\r\n\t\t\t\t//Remove it from keys\r\n\t\t\t\tlet idx = tabKeys.indexOf(relationKey);\r\n\t\t\t\ttabKeys.splice(idx, 1);\r\n\t\t\t}\r\n\r\n\t\t\t//Parse tabs regular tabs\r\n\t\t\tlet parsedTabs = tabKeys.map(parseTab.bind(this, spreadsheet));\r\n\r\n\t\t\tconsole.log(parsedTabs);\r\n\t\t\t//Merge tabs\r\n\t\t\tparsedTabs = Object.assign(...parsedTabs);\r\n\r\n\t\t\t//Once we have all well parsed, let's check relations\r\n\t\t\tif(typeof relations !== 'undefined')\r\n\t\t\t{\r\n\t\t\t\tapplyRelations(relations, parsedTabs);\r\n\t\t\t}\r\n\r\n\t\t\tlet files = {};\r\n\t\t\tObject.keys(parsedTabs)\r\n\t\t\t\t.filter(filterTabNames)\r\n\t\t\t\t.forEach(tabName =>\r\n\t\t\t\t{\r\n\t\t\t\t\tlet {rows, localizedRows} = parsedTabs[tabName];\r\n\t\t\t\t\tlet locales = Object.keys(localizedRows);\r\n\r\n\t\t\t\t\tif(locales.length)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlocales.forEach(locale =>{\r\n\t\t\t\t\t\t\t//Create locale\r\n\t\t\t\t\t\t\tif(typeof files[locale] === 'undefined')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tfiles[locale] = {};\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\trows = rows.map((row, index) =>{\r\n\t\t\t\t\t\t\t\tlet localized = localizedRows[locale][index];\r\n\t\t\t\t\t\t\t\treturn Object.assign(row, localized);\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tparsedTabs[tabName].rows = rows;\r\n\t\t\t\t\t\t\tconsole.log(rows);\r\n\t\t\t\t\t\t\tfiles[locale][tabName] = parsedTabs[tabName].rows;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(typeof files[data.title] === 'undefined')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tfiles[data.title] = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet tab = tabName;\r\n\t\t\t\t\t\tif(parsedTabs[tabName].isDict)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlet dict = {};\r\n\t\t\t\t\t\t\trows = rows.forEach(convertRowToDict.bind(this, dict));\r\n\t\t\t\t\t\t\ttab = Parsers.cleanDict(tabName);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(parsedTabs[tabName].isObjParse)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttab = Parsers.cleanObjParse(tabName);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfiles[data.title][tab] = rows;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\tconsole.log(files);\r\n\t\t})\r\n\r\n\t})\r\n\r\n};\r\n\r\nnew Main();\r\n"]}